<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Google Drive</title>
    <link id="favicon" rel="icon" href="https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png">
    <style>
        :root { --primary: #00ff41; --bg: #000500; --card: rgba(0, 20, 0, 0.9); --accent: #003b00; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: 'Courier New', monospace; overflow: hidden; }

        /* LOCKDOWN WHITE SCREEN */
        #lockdownScreen { position: fixed; inset: 0; background: white; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: black; transition: 0.5s; }
        #lockdownScreen h1 { font-size: 24px; margin-bottom: 10px; }
        
        /* HIDDEN BYPASS FIELD */
        #bypassInput { position: absolute; top: 0; right: 0; width: 50px; height: 30px; opacity: 0.02; border: none; outline: none; background: transparent; cursor: default; }
        #bypassInput:focus { opacity: 0.2; background: #eee; }

        /* MAIN UI */
        #mainApp { background: var(--bg); height: 100%; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; padding: 15px 30px; background: rgba(0,0,0,0.9); border-bottom: 1px solid var(--primary); }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 25px; padding: 40px; }
        .game-card { background: var(--card); border: 1px solid var(--accent); border-radius: 10px; padding: 20px; text-align: center; color: var(--primary); cursor: pointer; }
        .game-icon { width: 60px; height: 60px; margin-bottom: 10px; border-radius: 8px; }

        /* SETTINGS */
        #settingsPanel { position: fixed; top: 0; right: -350px; width: 320px; height: 100vh; background: #000; border-left: 2px solid var(--primary); z-index: 2000; transition: 0.4s; padding: 25px; color: var(--primary); }
        #settingsPanel.open { right: 0; }
        .input-box { background: #000; border: 1px solid var(--primary); color: var(--primary); padding: 10px; width: 100%; box-sizing: border-box; margin-bottom: 10px; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="lockdownScreen">
        <h1>SITE UNDER MAINTENANCE</h1>
        <p>Access is restricted. Please try again later.</p>
        <input type="password" id="bypassInput" placeholder="???" oninput="checkBypass(this.value)">
    </div>

    <div id="mainApp" class="hidden">
        <div id="authLayer" style="position:fixed; inset:0; background:#000; z-index:5000; display:flex; align-items:center; justify-content:center;">
            <div style="width:300px; text-align:center; border:1px solid var(--primary); padding:30px;">
                <h2 style="color:var(--primary)">SYSTEM_AUTH</h2>
                <input type="text" id="username" class="input-box" placeholder="USERNAME">
                <input type="password" id="password" class="input-box" placeholder="SECURITY_KEY">
                <button class="input-box" style="background:var(--primary); color:#000; font-weight:bold;" onclick="doLogin('pleb')">USER LOGIN</button>
                <div style="display:flex; gap:5px;">
                    <button class="input-box" style="font-size:10px;" onclick="doLogin('admin')">ADMIN LOGIN</button>
                    <button class="input-box" style="font-size:10px;" onclick="doLogin('root')">ROOT LOGIN</button>
                </div>
            </div>
        </div>

        <div id="arcade" class="hidden">
            <div class="top-bar">
                <div style="color:var(--primary)" id="clock">00:00</div>
                <div style="display:flex; gap:10px;">
                    <button id="settingsBtn" class="input-box" style="display:none; width:auto; margin:0;" onclick="toggleSettings()">⚙️ SETTINGS</button>
                    <button class="input-box" style="background:#f44; color:white; border:none; width:auto; margin:0;" onclick="location.replace('https://classroom.google.com')">PANIC</button>
                </div>
            </div>
            <div class="grid" id="gameGrid"></div>
        </div>
    </div>

    <div id="settingsPanel">
        <h3>ADMIN CONSOLE</h3>
        <button id="lockToggle" class="input-box" onclick="toggleServerLock()">LOCKDOWN: ON</button>
        <p style="font-size:10px;">Connected Users:</p>
        <div id="userList"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set, onValue, get } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDgRvxKypPsOx379SNleE6Uij7mKkEJxGY",
            authDomain: "monglearcade.firebaseapp.com",
            projectId: "monglearcade",
            databaseURL: "https://monglearcade-default-rtdb.firebaseio.com",
            appId: "1:637983149122:web:e6969750929fbb6b1871db"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // BYPASS LOGIC
        window.checkBypass = (val) => {
            // Change 'mongle77' to whatever bypass password you want
            if(val === "mongle77") {
                document.getElementById('lockdownScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
            }
        };

        // MAINTENANCE SYNC
        onValue(ref(db, 'global/maintenance'), (snapshot) => {
            const isLocked = snapshot.val() !== false;
            const role = sessionStorage.getItem('mRole');
            
            // If locked and not already bypassed/admin, show white screen
            if(isLocked && role !== 'root' && role !== 'admin') {
                document.getElementById('lockdownScreen').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
            }
            
            const btn = document.getElementById('lockToggle');
            if(btn) btn.innerText = isLocked ? "LOCKDOWN: ON" : "LOCKDOWN: OFF";
        });

        window.doLogin = (roleType) => {
            const user = document.getElementById('username').value || "Guest";
            const pass = document.getElementById('password').value;
            
            if(roleType === 'root' && pass === "OWNER_PASS") {
                sessionStorage.setItem('mRole', 'root');
                document.getElementById('settingsBtn').style.display = "block";
            } else if(roleType === 'admin' && pass === "ADMIN_PASS") {
                sessionStorage.setItem('mRole', 'admin');
                document.getElementById('settingsBtn').style.display = "block";
            } else {
                sessionStorage.setItem('mRole', 'pleb');
            }

            document.getElementById('authLayer').classList.add('hidden');
            document.getElementById('arcade').classList.remove('hidden');
            loadGames();
        };

        async function loadGames() {
            const res = await fetch(`https://api.github.com/repos/bob154526-hue/Mongle/contents/`);
            const items = await res.json();
            const grid = document.getElementById('gameGrid'); grid.innerHTML = "";
            items.forEach(item => {
                if(item.name.endsWith('.html') && item.name !== 'index.html') {
                    const d = document.createElement('div');
                    d.className = 'game-card';
                    d.innerHTML = `<h3>${item.name.replace('.html', '')}</h3>`;
                    d.onclick = () => {
                        const url = `https://raw.githack.com/bob154526-hue/Mongle/main/${item.name}`;
                        window.open(url, '_blank');
                    };
                    grid.appendChild(d);
                }
            });
        }

        window.toggleServerLock = () => get(ref(db, 'global/maintenance')).then(s => set(ref(db, 'global/maintenance'), !s.val()));
        window.toggleSettings = () => document.getElementById('settingsPanel').classList.toggle('open');
        setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);
    </script>
</body>
</html>
